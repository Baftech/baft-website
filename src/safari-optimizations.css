/* Safari-Specific Optimizations for Mobile Components */

/* Global Safari optimizations - avoid forcing transforms on all elements */
/* Use an opt-in helper instead of global enforcement to prevent layout bugs */
.webkit-gpu {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* Safari-specific viewport fixes */
html, body {
  -webkit-text-size-adjust: 100%;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

/* Safari video optimizations */
video {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-video-playback-quality: high;
  -webkit-media-controls-fullscreen-button: none;
}

/* Safari image optimizations */
img {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  image-rendering: auto;
  -webkit-image-rendering: auto;
}

/* Safari text rendering optimizations */
h1, h2, h3, h4, h5, h6, p, span, div {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-text-stroke: 0.01em transparent;
  text-rendering: optimizeLegibility;
}

/* Safari animation optimizations */
.animate, [class*="animate-"], [class*="transition-"] {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  will-change: transform, opacity;
}

/* Safari scroll optimizations */
.scroll-container, .overflow-auto, .overflow-scroll {
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

/* Remove layout-affecting transforms on common layout primitives */
.flex, [class*="flex-"], .grid, [class*="grid-"] {
  /* No forced transforms; prevents fixed/sticky glitches in Safari */
}

/* Safari transform optimizations */
[style*="transform"], [style*="scale"], [style*="rotate"] {
  -webkit-transform-origin: center center;
  transform-origin: center center;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* Safari transition optimizations */
[style*="transition"] {
  -webkit-transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

/* Safari WebGL optimizations */
canvas {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  image-rendering: auto;
  -webkit-image-rendering: auto;
}

/* Safari mobile-specific optimizations */
@media (max-width: 768px) {
  /* Optimize touch interactions */
  button, a, [role="button"] {
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
    -webkit-touch-callout: none;
  }
  /* Optimize scrolling on mobile Safari */
  body {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  /* Enhanced viewport handling for Safari's dynamic tab bar */
  html {
    height: 100svh;
    height: 100dvh;
  }
  body, .full-screen, .slide-container, .h-screen {
    height: 100svh;
    height: 100dvh;
    min-height: 100svh;
    min-height: 100dvh;
    transition: height 0.2s ease-out;
  }
  /* Safe area handling for when tab bar is hidden */
  .safe-area-top { padding-top: env(safe-area-inset-top, 0px); }
  .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom, 0px); }
  /* Dynamic height calculation for content that needs to fill viewport */
  .dynamic-height {
    height: calc(100svh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
    height: calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
  }
}

/* iOS specific optimizations */
@supports (-webkit-touch-callout: none) {
  .animate, [class*="animate-"] {
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
}

/* Opt-in GPU accel helper */
.gpu-accelerated {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  will-change: transform, opacity;
}

/* Positioning helpers: avoid forcing transforms */
.sticky, .fixed, .absolute, .relative {
  /* Do not force transforms; prevents Safari from breaking stacking/positioning */
}
